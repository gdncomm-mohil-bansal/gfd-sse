# GFD (Guest-Facing Display) Application

A real-time Vue.js application that connects to the backend SSE (Server-Sent Events) service to display shopping cart updates in real-time.

## Features

- 🔐 **Secure OTP Authentication**: Connect using a 6-digit code generated by the POS system
- 📡 **Real-time Updates**: See cart changes instantly via Server-Sent Events
- 🛒 **Beautiful Cart Display**: Modern, responsive UI showing products with images
- 💰 **Live Pricing**: Real-time subtotals and total calculations
- 🎯 **Checkout Flow**: Integrated checkout display with payment status
- 🔌 **Connection Management**: Easy connect/disconnect controls

## Prerequisites

- Node.js 20.19.0+ or 22.12.0+
- npm or yarn
- Backend services running:
  - `dummy-off2on` (port 8080) - Generates OTP and publishes cart events
  - `dummy-off2on-redis` (port 8081) - SSE service
  - Redis server

## Installation

```bash
# Install dependencies
npm install
```

## Configuration

1. Copy `.env.example` to `.env`:
```bash
cp .env.example .env
```

2. Update the API URL in `.env` if your backend is running on a different port:
```env
VITE_API_URL=http://localhost:8081
```

## Development

Run the development server:

```bash
npm run dev
```

The application will be available at `http://localhost:5173` (or another port if 5173 is in use).

## Building for Production

```bash
# Type check
npm run type-check

# Build
npm run build

# Preview production build
npm run preview
```

## Usage

### Step 1: Generate OTP
Ask the cashier to generate an OTP code from the POS system (`dummy-off2on`):
- Use the `/api/otp/generate` endpoint with a userId
- Note the 6-digit OTP displayed

### Step 2: Connect to GFD
1. Open the GFD application in a browser
2. Enter the Session ID (userId)
3. Enter the 6-digit OTP
4. Click "Connect"

### Step 3: View Real-time Updates
- Cart items will appear automatically as the cashier scans products
- See live updates for:
  - Product additions
  - Quantity changes
  - Price calculations
  - Checkout status

### Step 4: Disconnect
Click the "Disconnect" button when the transaction is complete.

## How It Works

### Architecture

```
┌─────────────────┐         ┌─────────────┐         ┌─────────────────┐
│  POS Terminal   │────────▶│    Redis    │◀────────│   GFD Display   │
│ (dummy-off2on)  │         │   Pub/Sub   │         │  (this app)     │
│  Port: 8080     │         └─────────────┘         │  Port: 5173     │
└─────────────────┘                                  └─────────────────┘
       │                           ▲                          │
       │ Publishes Events          │                          │
       └───────────────────────────┘                          │
                                                               │
                                   ┌───────────────────────────┘
                                   │ SSE Connection
                                   │
                            ┌──────▼──────────┐
                            │  SSE Service    │
                            │(dummy-off2on-   │
                            │    redis)       │
                            │  Port: 8081     │
                            └─────────────────┘
```

### Event Flow

1. **OTP Generation**:
   - POS generates OTP and stores in Redis
   - OTP is displayed to user

2. **SSE Connection**:
   - GFD connects to `/api/sse/connect?userId=X&otp=123456`
   - Backend validates OTP from Redis
   - SSE connection established

3. **Real-time Updates**:
   - POS publishes cart events to Redis
   - SSE service subscribes to Redis channel
   - Events forwarded to connected GFD clients

4. **Event Types**:
   - `CART_ITEM_ADDED`: Product added to cart
   - `CART_ITEM_REMOVED`: Product removed
   - `CART_UPDATED`: Cart quantities changed
   - `CHECKOUT_INITIATED`: Checkout started
   - `CHECKOUT_COMPLETED`: Payment successful
   - `CHECKOUT_FAILED`: Payment failed
   - `CONNECTION_ESTABLISHED`: Initial connection
   - `HEARTBEAT`: Keep-alive ping

## API Endpoints Used

### SSE Connection
```
GET /api/sse/connect?userId={userId}&otp={otp}
```

### Disconnect
```
POST /api/sse/disconnect/{userId}
```

### Check Status
```
GET /api/sse/status/{userId}
```

## Components

### ConnectionForm
- OTP input and validation
- User ID entry
- Connection establishment

### CartDisplay
- Real-time cart items list
- Product images and details
- Quantity display
- Running totals
- Disconnect button

### CartItemCard
- Individual product display
- Product image (with fallback)
- Price and quantity
- Subtotal calculation

### CheckoutDisplay
- Modal overlay during checkout
- Order summary
- Payment status (processing/success/failed)
- Pricing breakdown with discounts/tax

## Store (State Management)

The `gfdStore` (Pinia) manages:
- Connection state
- Cart items
- Totals and quantities
- SSE event handling
- Checkout mode

## Styling

- Modern, gradient-based design
- Responsive layout for various screen sizes
- Smooth animations and transitions
- POS-style professional appearance
- Color-coded status indicators

## Troubleshooting

### Connection Issues

**Problem**: Cannot connect to SSE service
- Ensure backend is running on correct port (8081)
- Check CORS configuration
- Verify OTP is valid and not expired

**Problem**: "Invalid or expired OTP"
- Generate a new OTP from POS
- OTPs are single-use and expire after 5 minutes

### Display Issues

**Problem**: Cart not updating
- Check browser console for errors
- Verify SSE connection is active (green badge)
- Ensure Redis is running

**Problem**: Images not loading
- Check network connection
- Images use Unsplash for demo purposes
- Fallback to initials-based avatars

## Development

### Project Structure

```
src/
├── components/          # Vue components
│   ├── ConnectionForm.vue
│   ├── CartDisplay.vue
│   ├── CartItemCard.vue
│   └── CheckoutDisplay.vue
├── stores/              # Pinia stores
│   └── gfdStore.ts
├── services/            # Services
│   └── sseService.ts
├── types/               # TypeScript types
│   └── index.ts
├── App.vue              # Root component
└── main.ts              # Entry point
```

### Adding New Features

1. **Custom Event Handlers**: Add to `gfdStore.handleSSEMessage()`
2. **New Components**: Create in `components/` and import in `App.vue`
3. **Styling**: Use scoped styles in components or update global styles in `App.vue`

## Production Deployment

1. Build the application:
```bash
npm run build
```

2. The `dist/` folder contains static files

3. Serve with any static file server:
```bash
# Using serve
npx serve dist

# Using nginx, Apache, etc.
```

4. Configure backend URL via environment variables

## License

This project is part of the GFD-SSE demo system.

## Support

For issues or questions, please refer to the main project documentation.
